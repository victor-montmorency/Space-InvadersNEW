<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <canvas id="tela" width="400" height="600" id="gamescreen"></canvas>
        <img src="background.png"  id="background" >
        <div id="gameoverbox"><div id="ranking">RANKING</div></div>
        <div id="newgamebox">
            <div id="newgame" onclick="iniciar()">COMEÇAR NOVO JOGO</div>
        </div>
<script>
    
// Space Invaders
// Autor: Ayo Oyewole
// Adaptado por: Gilson Pereira
// Código fonte original: http://www.ayodeji.ca/space-invaders/

// Programa principal
function advance(event) {
    
    if (event instanceof KeyboardEvent && event.keyCode === 13&&aliensRestantes.length==0) {
        location.reload();}
    }
    
    window.addEventListener('keypress', advance);
var somTiro = new Audio
somTiro.src = "somtiro.wav"

var SomAlienAtingido = new Audio
SomAlienAtingido.src = "somAlienAtingido.wav"

var somnave = new Audio
somnave.src = "somnave.wav"

backgroundmusic = new Audio
backgroundmusic.src = "backgroundmusic.wav"

somnaveatingida = new Audio
somnaveatingida.src = "naveatingida.wav"

somfimdejogo = new Audio
somfimdejogo.src = "somfimdejogo.wav"

canhaoatingido = new Audio
canhaoatingido.src = "canhaoatingido.wav"

var naveeliminada = false
var NumeroDeAliensRestantes = 55
var tela
var c;
var posNave = -20
var canhao;
var laser;
var alien;
var vidas = 3
var canhaoX = 180;
var canhaoY = 529;
var laserX = 193;
var laserY = 510;
var alienX = 0;
var alienY = 0;
var inicioLaser = false;
var impactoLaserX;
var laserMovendo;
var posicao = 0;
var pontos = 0;
var alienLinhas = [10, 38, 66, 94, 122, 150, 178, 206, 234, 262, 290];
var alienColunas = [55, 85, 115, 145, 175];
var aliensRestantes = [];

const C_ALTURA = 600;
const C_LARGURA = 400;

const TECLA_ESQUERDA = 37;
const TECLA_DIREITA = 39;
const TECLA_ACIMA = 38;

onkeydown = moverCanhao; // Define função chamada ao se pressionar uma tecla



// Sub-rotinas (funções)
function iniciarloop(){var timing = 20

function loop() {
  moverAliens();
  if(NumeroDeAliensRestantes <45){timing = 15}
  if(NumeroDeAliensRestantes <25){timing = 10}
  window.setTimeout(loop, timing);
  
}
loop();}

function navesVermelhas(){
    var primeiranave = setTimeout(() => {
    posNave = -19
    somnave.play()
    var timer = setInterval(()=>{
    c.drawImage(nave, posNave,40)
    posNave+=1
    c.clearRect(posNave-1, 40,1,46)
        if(posNave == 400 || naveeliminada == true || vidas == 0){
        clearInterval(timer)
        somnave.pause()
        somnave.currentTime = 0;
        c.clearRect(0, 0 , 400, 100)
}
    },10);
    }, 4000);

var terceiranave = setTimeout(() => {
    naveeliminada = false
    posNave = -19
    somnave.play()
        var timer2 = setInterval(()=>{
        c.drawImage(nave, posNave,40)
        posNave+=1
        c.clearRect(posNave-1, 40,1,46)
        if(posNave == 400 || naveeliminada == true || vidas == 0){
        somnave.pause()
        somnave.currentTime = 0;
        clearInterval(timer2)
        c.clearRect(0, 0 , 400, 100)
}
    },10);
    }, 15000);

var quartanave = setTimeout(() => {
        naveeliminada = false
        posNave = 400
        somnave.play()
        var timer = setInterval(()=>{
        c.drawImage(nave, posNave,40)
        posNave-=1
        c.clearRect(posNave+51, 40,1,46)
        if(posNave == -50 || naveeliminada == true || vidas == 0){
        clearInterval(timer)
        somnave.pause()
        somnave.currentTime = 0;
        c.clearRect(0, 0 , 400, 100)
}
    },10);
    }, 20000);
    var segundanave = setTimeout(() => {
        naveeliminada = false
        posNave = 400
        somnave.play()
        var timer = setInterval(()=>{
        c.drawImage(nave, posNave,40)
        posNave-=1
        c.clearRect(posNave+51, 40,1,46)
        if(posNave == -50 || naveeliminada == true || vidas == 0){
        clearInterval(timer)
        somnave.pause()
        somnave.currentTime = 0;
        c.clearRect(0, 0 , 400, 100)
}
    },10);
    }, 10000);
}

function iniciar() {
        tela = document.getElementById("tela");
        c = tela.getContext("2d");
        document.getElementById("gameoverbox").style.zIndex = -2;
        document.getElementById("newgamebox").style.zIndex = -2;
        posicionarAlien();
        carregarImagens();
        navesVermelhas()
        backgroundmusic.play()
        setInterval("alienAtingido()", 6);    
        setInterval("naveatingida()", 6)
        iniciarloop()
    }


function posicionarAlien() {
    for (var i = 0; i < alienLinhas.length; i++){
        for (var j = 0; j < alienColunas.length; j++){
            var novoAlien = {
                posX : alienLinhas[i],
                posY : alienColunas[j],
                foiAtingido : false
			};
			
            aliensRestantes[aliensRestantes.length] = novoAlien;
        }
    }
}    
function carregarImagens() {
    canhao = new Image();
    canhao.src = "canhao.png";
    canhao.onload = function(){
        c.drawImage(canhao, canhaoX, canhaoY);
    }
    
    laser = new Image();
    laser.src = "laser.png";
    
    alien = new Image();
    alien.src = "alien.png";
    
    gameover = new Image();
    gameover.src = "gameover.png"
    
    nave = new Image;
    nave.src = "nave.png"
}
function moverAliens(){
    if (posicao <= 65){
        alienX += 1;
        posicao += 1;
    } else if ((posicao > 65) && (posicao <= 80)){
        alienX += 1;
        alienY += 1
        posicao += 1;            
    } else if ((posicao > 80) && (posicao <= 147)){
        alienX -= 1;
        posicao += 1;
    } else if ((posicao > 147) && (posicao < 162)){
        alienX -= 1;
        alienY += 1;
            posicao += 1;
        } else{
            posicao = 0;
        }
        
        for (var i = 0; i < aliensRestantes.length; i++){
            if (!aliensRestantes[i].foiAtingido){
                c.clearRect((alienX + aliensRestantes[i].posX - 1), (alienY + aliensRestantes[i].posY - 1), 20, 25);
                c.drawImage(alien, (alienX + aliensRestantes[i].posX), (alienY + aliensRestantes[i].posY));
                
				
                if ((aliensRestantes[i].posY + alienY + 23) >= 530){
                    fimDeJogo();
                }
            }
        }
            
            }
    
    function alienAtingido(){
    for(var i = 0; i < aliensRestantes.length; i++){
        if ((laserY >= (alienY + aliensRestantes[i].posY)) && (laserY <= (alienY + aliensRestantes[i].posY + 20)) && 
            (impactoLaserX >= (alienX + aliensRestantes[i].posX - 5)) && (impactoLaserX <= (alienX + aliensRestantes[i].posX + 18))){
            if (!aliensRestantes[i].foiAtingido){
                NumeroDeAliensRestantes--
                if(NumeroDeAliensRestantes == 0){fimDeJogo()}
                c.clearRect((alienX + aliensRestantes[i].posX - 1), (alienY + aliensRestantes[i].posY - 1), 20, 25);
                aliensRestantes[i].foiAtingido = true;
                if(aliensRestantes[i]["posY"] == 175){pontos+=10}
                if(aliensRestantes[i]["posY"] == 145){pontos+=10}
                if(aliensRestantes[i]["posY"] == 115){pontos+=20}
                if(aliensRestantes[i]["posY"] == 85){pontos+=20}
                if(aliensRestantes[i]["posY"] == 55){pontos+=40}
                SomAlienAtingido.play()
                c.fillStyle = "black"
                c.fillRect(90,0,50,25)
                c.clearRect(impactoLaserX, laserY, 6, 19);
                laserY = 0;
            
            }
        }
        
    }
    c.textAlign = "left";
    c.font = "100 20px Courier New";
    c.fillStyle = "white";
    c.fillText("Pontos: "+pontos, 10,20);
    c.textAlign="right"
    c.fillText("vidas: "+vidas, 390,20);

}
var base;

setTimeout(() => {
    laserinvertido()
}, 3000);
function laserinvertido(){
    valorcanhaoX = canhaoX+15
    base = aliensRestantes[0]["posY"] + alienY
    var intervaloLaserInvertido = setInterval(() => {
    c.drawImage(laser, valorcanhaoX,base )
    base +=1
    c.clearRect(valorcanhaoX,base -19, 5, 1)
    if(base>500 && base< 610 && valorcanhaoX<= canhaoX+30&& valorcanhaoX >= canhaoX-1){
        c.clearRect(valorcanhaoX,base -19 , 5, 50)
        c.clearRect(370,0,50,25)
        vidas--
        clearInterval(intervaloLaserInvertido)
        if(vidas == 0){fimDeJogo()}
        laserinvertido()
        canhaoatingido.play()
    }
    if(jogoganho == true || alienY>250){clearInterval(intervaloLaserInvertido)}
    if(base>650){base = aliensRestantes[4]["posY"] + alienY
        valorcanhaoX = canhaoX
}
}, 10);
}


function naveatingida(){
    if(laserX<posNave+50 && laserX>posNave  && laserY>10 &&laserY<100){
        if(naveeliminada == false){
            somnave.pause()
            somnave.currentTime = 0;

            c.fillStyle = "black"
            c.fillRect(90,0,50,25)
            pontos += Math.floor(Math.random() * 100);
            somnaveatingida.play()
}
        naveeliminada = true
    }
    
}
var jogoganho
function fimDeJogo(){
    canhaoX = 180;
    laserX = 193;
    laserY = 520;
    alienX = 0;
    alienY = 0;
    posicao = 0;
    aliensRestantes = [];
    inicioLaser = false;
	
    c.drawImage(gameover, 0, 0)    
    c.textAlign = "center";
    c.font = "20px Arial";
    c.fillStyle = "white";
    c.fillText("Aperte enter para começar novamente", 200,500);
    onkeydown = null;
    document.getElementById("gameoverbox").style.zIndex = 3;
    backgroundmusic.pause()
    somnave.currentTime = 0;
    somfimdejogo.play()
    jogoganho = true

}

function moverCanhao(tecla){
    var codigo = tecla.keyCode;
    
    if ((codigo == TECLA_DIREITA) && (canhaoX <= 360)){
        c.clearRect(canhaoX, 529, 29, 58);
        canhaoX += 8;
        laserX += 8;
		c.drawImage(canhao, canhaoX, canhaoY);
    }
    
    if ((codigo == TECLA_ESQUERDA) && (canhaoX >= 9)){
        c.clearRect(canhaoX, 529, 30, 58);
        canhaoX -= 8;
        laserX -= 8;
		c.drawImage(canhao, canhaoX, canhaoY);
    }
    
    if ((codigo == TECLA_ACIMA) && !inicioLaser){
        somTiro.play()
        inicioLaser = true;
        c.drawImage(laser, laserX, laserY);
        impactoLaserX = laserX;
        laserMovendo = setInterval("dispararLaser()", 5);
    }
}

function dispararLaser(){
    if (inicioLaser && (laserY >= 60)){
        laserY -= 10;
        c.clearRect(impactoLaserX, (laserY + 10), 6, 19);
        if (laserY >= 70){
            c.drawImage(laser, impactoLaserX, laserY);
        }
    }
	
    if (laserY < 60){
        clearInterval(laserMovendo);
        inicioLaser = false;
        laserY = 510;
    }
}
</script>
</body>
</html>